import pandas as pd
import requests
import io

# 1. Fetch the data - adding verify=False to bypass SSL check
url = "https://raw.githubusercontent.com/ttwyman2210-ops/csv-test-repo/refs/heads/main/Test_Sheet1.csv"

# Note: verify=False is what fixes the 'local issuer certificate' error
response = requests.get(url, verify=False)

# 2. Initial Load
demo = pd.read_csv(io.StringIO(response.text))

# 3. Data Cleaning and Slicing
subset = demo.iloc[8:18, [1, 4]].copy()
subset.columns = ['DNS', 'Severity']
subset['Severity'] = pd.to_numeric(subset['Severity'])

# Pre-calculate stats for Power BI visuals
subset['Mean_Severity'] = subset['Severity'].mean()
subset['Std_Dev'] = subset['Severity'].std()

# Power BI will now see the 'subset' table
